# コミュニケーション運用ルール（AI↔ユーザ）


## ユーザ負担最小化（必須）
- 依頼は「コピペ1発」または「ファイルアップロード→AI側で処理→DL→上書き」の形を優先する（思考負担を減らす）。
- ローカル実行が必要な場合は必ず **「これはあなたの作業です」** と明記し、具体的な手順（PowerShell/cmdのコマンドまで）を提示する。
- 「ローカルにあるから」で止めず、(A)ローカル実行 と (B)アップロード代替案 の両方を必ず提示し、短期/中期/長期の効率所感も添える。

## AIの独断行動の禁止(AI内での試行・思考は自由)
-  AIは、ユーザと明示的に合意され、
   かつ 各種正本ドキュメントにおいて
   許可として明文化されたもののみを出力してよい。
   もし出力・作成したい事項がある場合はユーザへ端的に提案・合意の後に行う。
   新たな切り口などの提案は大歓迎。

## AIは、正本との整合性が確認できない場合、
- 「確認を求める」ことを
   最優先の正当行動としてよい。

## 依頼・提案の扱い
- ユーザの依頼/提案は「目的（全場の長期ROI最大化）」「制約（1日5〜15R程度など）」基準で評価する
- 結論は「採用/保留/却下」を明示し、理由を短く添える
- 保留にした有効打は台帳（LEDGER）に記録する（台帳本文表示は重ければ省略可）

## ログ/出力
- 長いログは貼らない（最終数値/ファイルパス/再現コマンド/重要エラー1行）
- コマンド提示はPowerShell/cmdを明示する

## 引継ぎ（HANDOVER）運用：壊れない生成方式（手戻りゼロ優先）

### まず結論（運用ルール）
- **チャット切替の直前は、必ず「1コマンドで HANDOVER.md + zip を生成」してから切り替える。**
- HANDOVER.md は **“docs正本” だけ**をソースにして生成する（ターミナル出力/ログを貼らない）。  
  → これで「ログ混入で壊れる」経路を遮断する。
- 生成後に **lint（汚染チェック）**を必ず通す（usage/Traceback/PS> などの混入を検知したら失敗にする）。

### なぜ壊れたか（混入経路の推定）
- もっとも多いのは **PowerShell/python の標準出力・エラー出力（usage:, Traceback, ParserError など）を、コピペやリダイレクトで HANDOVER.md に混入**させるパターン。
- 次に多いのは **“世界線（baseline/除外/投資列/期間/active条件）” の前提が揃わないまま、別条件の結果を同じ名前で扱ってしまう**パターン。
- さらに、JSON/BOM や 列名差（jcd/track_norm 等）で例外が出たログを貼ると、以後の手順が迷子になりやすい。

### 壊れない生成方式（1コマンド）
1. `generate_handover_bundle.bat` を実行する  
   - HANDOVER.md を生成（docs正本から合成）
   - 混入チェック（lint）
   - zip を runs 配下に出力（新チャットへ持ち込むファイル一式）

> **注意**：チャット内の指示で “複数行コマンド” を貼るより、  
> **bat 1本**に集約して “貼り間違い” を消すのが目的。

### 切替時の必須チェックリスト（コピペ用）
- [ ] `generate_handover_bundle.bat` を実行し、zip の出力パスが表示されている
- [ ] HANDOVER.md の先頭に「今回の世界線（CAP/EXCL/期間/投資列/active条件）」が明記されている
- [ ] ガード（worldline guard）が OK になっている（guardレポートが zip に入っている）
- [ ] 新チャットの最初に、**HANDOVER.md を貼り付ける + zip を添付**した
- [ ] 追加で AI に見せる必要がある大きいCSV（payouts 等）がある場合は「どのファイルをアップロードするか」も HANDOVER に明記した

### 切替提案トリガー（v2：迷子リスク中心）
「体感の重さ」ではなく、迷子リスクで発火する。

【強制発火（1つで切替提案＋HANDOVER_BUNDLE生成）】
- 複数世界線（ROI算出条件/前提）が同時に走り始めた
- ファイル名/パス/列名の揺れでエラーが連続（原因が構造化）
- 「本来の第一手」が見えにくくなった

【切替提案の必須出力（未完でも先に出す／これが揃うまで作業を進めない）】
1) 理由(1–2行：どの迷子リスクが発火したか)
2) 引継ぎコピペ全文
3) 次の最短手順チェックリスト
4) 生成物一覧（ファイル/パス/再現コマンド）

## ルール・方針の記録（忘却防止）
- ユーザ作業は極力「コマンドのコピペ」「指定ファイルのアップロード」など、ユーザの思考負担が少ない“機械的作業”で完結する形で依頼する（手順は具体的・一発で再現可能に）。
- ユーザが「運用ルール」「方針」「制約」「優先順位」を追加・更新した場合、AIは**原則として関連ドキュメント（docs正本）へ記録**する。
- 記録はユーザ作業を極力減らすため、AI側で更新版ファイル/ZIPを生成し、ユーザは**ダウンロード→上書き**で反映できる形を優先する。
- 記録対象の例：payout運用（再利用/差分DL）、worldline guard手順固定、除外場運用、cap運用、切替提案トリガー等。

### ベースライン関連スクリプト／バッチの変更ガード（重要）
- **実践フロー**および **30d/90d検証のベースライン**に関わるスクリプト／バッチを **新規作成・更新する場合は、必ずユーザの合意を得てから実施する**（無断変更しない）。
- これらをチャット内で解析・再計算に使いたい場合、**作業効率／精度が大幅に改善できると判断できる場合に限り**、ユーザに「アップロード」を提案する（強制しない）。
- 合意が得られるまでは、AIは **変更案（差分／パッチ案）まで**を提示し、実ファイルの作成・更新は行わない。

